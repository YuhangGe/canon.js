<!DOCTYPE html>
<html>
	<head>
		<title>JavaScript Audio Write Example</title>
		<script type="text/javascript" src="jquery-1.7.2.js"></script>
		<script type="text/javascript" src="js-printf.js"></script>
	</head>
	<body>

		<input type="button" onclick="start();" value="play" id="btn-play" />

		<button onclick="stop()">
			stop
		</button>

		<script type="text/javascript">
			var context = new webkitAudioContext(), afterBuffer = null, afterSource = null;
		/*	$(function() {
				var xhr = new XMLHttpRequest();
				xhr.open("GET", "music/after.mp3", true);
				xhr.responseType = 'arraybuffer';
				xhr.onload = function(e) {
					context.decodeAudioData(xhr.response, function(buffer) {
						afterBuffer = buffer;
						$("#btn-play").attr("disabled", false);
						$.log(buffer.length);
					}, null);

				};
				xhr.send();
			}); */
            function start() {
                var freq = 440,
                    ab = context.createBuffer(1, 44100, 44100),
                    buf = ab.getChannelData(0);
                $.log(ab);
                $.log(buf.length);
                for(var i = 0; i<44100; i++){
                    buf[i] = Math.sin( freq * 2 * Math.PI * i / 44100);
                }
                afterSource = context.createBufferSource();
                afterSource.buffer = ab;
                afterSource.connect(context.destination);
                afterSource.noteOn(0);
            }
			function _start() {
				var jN = context.createJavaScriptNode(16384);
				afterSource = context.createBufferSource();
				afterSource.buffer = afterBuffer;
				afterSource.connect(jN);
				jN.onaudioprocess = function(e) {
					//$.log("process")
					var lOut = e.outputBuffer.getChannelData(0);
					var rOut = e.outputBuffer.getChannelData(1);
					var lIn = e.inputBuffer.getChannelData(0);
					var rIn = e.inputBuffer.getChannelData(1);
					for(var i = 0; i < this.bufferSize; i++) {
						lOut[i] = lIn[i];
						rOut[i] = rIn[i];
					}

				};
				jN.connect(context.destination);
				afterSource.noteOn(0);
			}

			function stop() {
				afterSource.noteOff(0);
			}
		</script>
	</body>
</html>